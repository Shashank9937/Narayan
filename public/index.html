<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Narayan Enterprises</title>
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <a href="#" id="brandLink" class="brand-wrap" title="Go to Overview" aria-label="Narayan Enterprises - Go to Overview">
        <img src="/logo.svg" alt="Narayan Enterprises Logo" class="brand-logo" />
        <div>
          <h1>Narayan Enterprises</h1>
          <p>Operations Control Center</p>
        </div>
      </a>
      <div class="header-actions">
        <button id="darkModeToggle" class="small theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">☀</button>
        <div id="sessionBar" class="session-bar hidden">
          <span id="userMeta"></span>
          <button id="logoutBtn" class="small danger">Logout</button>
        </div>
      </div>
    </header>

    <section id="loginPanel" class="panel login-panel">
      <div class="login-logo-wrap">
        <img src="/logo.svg" alt="Narayan Enterprises" class="login-logo" />
        <h2>Operations Control Center</h2>
      </div>
      <form id="loginForm">
        <input name="username" placeholder="Username" required />
        <input name="password" type="password" placeholder="Password" required />
        <button type="submit">Login</button>
      </form>
      <p class="hint">Demo users: admin/admin123, accountant/account123, manager/manager123</p>
    </section>

    <section id="appContent" class="hidden app-shell">
      <nav class="section-nav" id="sectionNav">
        <button class="nav-btn active" data-target="overviewSection">Overview</button>
        <button class="nav-btn" data-target="employeeSection">Employees</button>
        <button class="nav-btn" data-target="attendanceSection">Attendance</button>
        <button class="nav-btn" data-target="salarySection">Salary</button>
        <button class="nav-btn" data-target="truckSection">Trucks</button>
        <button class="nav-btn" data-target="settingsSection">Settings</button>
      </nav>

      <section id="overviewSection" class="section-view active-view">
        <div id="lastRefreshedWrap" class="last-refreshed-wrap hidden">
          <span id="lastRefreshed">Last refreshed: —</span>
          <button id="manualRefreshBtn" class="small">Refresh</button>
        </div>
        <section class="cards" id="cards"></section>
      </section>

      <section id="employeeSection" class="section-view">
        <div class="grid">
          <section class="panel" id="employeePanel">
            <h2>Add Employee</h2>
            <form id="employeeForm">
              <input name="name" placeholder="Employee Name" required />
              <input name="role" placeholder="Role" required />
              <input name="monthlySalary" type="number" min="1" step="0.01" placeholder="Monthly Salary" required />
              <button type="submit">Add Employee</button>
            </form>
          </section>
        </div>

        <section class="panel" id="employeeListPanel">
          <div class="row wrap">
            <h2>Employee Management</h2>
            <input id="employeeSearchInput" type="text" placeholder="Search employee by name or role" />
          </div>
          <div class="table-wrap">
            <table id="employeeTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Monthly Salary</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="attendanceSection" class="section-view">
        <div class="grid">
          <section class="panel" id="attendancePanel">
            <h2>Mark Attendance</h2>
            <form id="attendanceForm">
              <select name="employeeId" id="attendanceEmployee" required></select>
              <input name="date" type="date" required />
              <select name="status" required>
                <option value="present">Present</option>
                <option value="absent">Absent</option>
              </select>
              <button type="submit">Save Attendance</button>
            </form>
          </section>
        </div>

        <section class="panel" id="attendanceReportPanel">
          <div class="row wrap">
            <h2>Monthly Attendance Report</h2>
            <div class="row">
              <input id="attendanceMonthInput" type="month" />
              <button id="refreshAttendanceReport" class="small">Load</button>
              <button id="downloadAttendanceCsv" class="small">Download Attendance CSV</button>
            </div>
          </div>
          <div class="table-wrap">
            <table id="attendanceReportTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Present Days</th>
                  <th>Absent Days</th>
                  <th>Total Marked</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="salarySection" class="section-view">
        <div class="grid">
          <section class="panel" id="advancePanel">
            <h2>Salary Advance</h2>
            <form id="advanceForm">
              <select name="employeeId" id="advanceEmployee" required></select>
              <input name="date" type="date" required />
              <input name="amount" type="number" min="1" step="0.01" placeholder="Advance Amount" required />
              <input name="note" placeholder="Note (optional)" />
              <button type="submit">Add Advance</button>
            </form>
          </section>
        </div>

        <section class="panel" id="salaryPanel">
          <div class="row">
            <h2>Salary Summary (Current Month)</h2>
            <button id="downloadSalaryCsv" class="small">Download Salary CSV</button>
          </div>
          <div class="table-wrap">
            <table id="salaryTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Monthly</th>
                  <th>Advances (Month)</th>
                  <th>Remaining (Month)</th>
                  <th>Months Worked</th>
                  <th>Total Earned (All Time)</th>
                  <th>Total Advances (All Time)</th>
                  <th>Total Remaining (All Time)</th>
                  <th>Slip</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="truckSection" class="section-view">
        <div class="grid">
          <section class="panel" id="truckPanel">
            <h2>Truck / Raw Material Entry</h2>
            <form id="truckForm">
              <input name="date" type="date" required />
              <input name="truckNumber" placeholder="Truck Number" required />
              <input name="driverName" placeholder="Driver Name" />
              <input name="rawMaterial" placeholder="Raw Material" required />
              <input name="quantity" type="number" min="0.01" step="0.01" placeholder="Quantity (quintals)" required />
              <input name="pricePerQuintal" type="number" min="0" step="0.01" placeholder="Price per Quintal" id="truckPricePerQuintal" />
              <div class="truck-total-row">
                <label for="truckTotalAmount">Total Amount</label>
                <output id="truckTotalAmount" class="truck-total-output">—</output>
              </div>
              <input name="origin" placeholder="Origin" />
              <input name="destination" placeholder="Destination" />
              <input name="notes" placeholder="Notes" />
              <button type="submit">Add Truck Entry</button>
            </form>
          </section>
        </div>

        <section class="panel" id="truckReportPanel">
          <div class="row wrap">
            <h2>Truck Report</h2>
            <div class="row">
              <input id="truckSearchInput" type="text" placeholder="Search truck/material/driver" />
              <button id="downloadTruckCsv" class="small">Download Truck CSV</button>
            </div>
          </div>
          <div class="table-wrap">
            <table id="truckTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Truck</th>
                  <th>Driver</th>
                  <th>Material</th>
                  <th>Qty (Qntl)</th>
                  <th>Price/Qntl</th>
                  <th>Total</th>
                  <th>Origin</th>
                  <th>Destination</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </section>

      <section id="settingsSection" class="section-view">
        <section class="panel" id="changePasswordPanel">
          <h2>Change Password</h2>
          <form id="changePasswordForm">
            <input name="currentPassword" type="password" placeholder="Current Password" required />
            <input name="newPassword" type="password" placeholder="New Password (min 8 chars)" required />
            <button type="submit">Update Password</button>
          </form>
        </section>
      </section>
    </section>

    <div id="toast" class="toast" aria-live="polite"></div>

    <script src="/app.js"></script>
  </body>
</html>
